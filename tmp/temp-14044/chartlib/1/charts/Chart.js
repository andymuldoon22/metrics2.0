/* Copyright (c) Ericsson 2019 */

define("chartlib/charts/_base/Chart",["jscore/core","chartlib/base/d3","chartlib/charts/Title","chartlib/charts/Grid","chartlib/charts/Legend"],function(t,e,i,n,r){"use strict";function a(t){if(this.options.legend!==!1&&t&&"toggle"===t.type){var e=t.entry,i=this.legend.getLegendData().filter(function(t){return t.visible!==!1}).length,n=i+(e.visible!==!1?-1:1);n>0&&(this.toggleEntryVisibility(e,t.index),this.redraw())}}function o(t,e){var i="";return e.forEach(function(e,n){var r="";if(Array.isArray(e.data))if("title"===t){var a=e.label.toString();a.length>r.length&&(r=a)}else e.data.forEach(function(e,i){var n=e[t].toString();n.length>r.length&&(r=n)});else(e[t]||0===e[t])&&(r=e[t].toString());r.length>i.length&&(i=r)}),i}function s(){function i(i,n,r,a){var o,s=this.getElement(),l=this.view.getTooltip(),h=l.find(".tooltipContent"),d=r.call(this,i,n),g=s.getPosition(),c={height:s.getProperty("offsetHeight"),width:s.getProperty("offsetWidth")};if(a){var f=t.Element.parse(d);Array.from(h.children()).forEach(function(t){t.remove()}),h.setText(""),h.append(f)}else h.getText()!==d&&h.setText(d);l.setStyle({display:"block"}),o={height:l.getProperty("offsetHeight"),width:l.getProperty("offsetWidth")};var p=15,u=n[0]+p,v=Math.max(p,n[1]-o.height-p);g.left+u+o.width+p>c.width&&(u=Math.max(p,n[0]-p-o.width)),e.event.clientY-o.height-p<g.top&&(v=n[1]+p),l.setStyle({top:v,left:u,opacity:1})}function n(){this.view.getTooltip().setStyle({display:"none"})}var r=this.options,a=r.tooltip,o=r.legend.tooltip;if(a||o){var s=this.getD3Element(),l=this,h=this.getTooltipContent,d=this.getLegendTooltipContent,g=function(t){return t.attr("class").indexOf("datapoint")!==-1},c=function(t){return t.attr("class").indexOf("legendItem")!==-1},f=function(t,n){var r,a=e.mouse(s[0][0]),o=e.select(this);if(g(o))o.attr("stroke",e.rgb(o.attr("fill")).darker(1.2)).attr("stroke-width",2),r=h;else if(c(o)){if("function"!=typeof d)throw Error("Legend tooltip format function option required.");r=d}i.call(l,t,a,r,n)},p=function(){var t=e.select(this);g(t)&&t.attr("stroke-width",0),n.call(l)};if(a&&s.selectAll(".hoverable").on("mousemove",function(t){f.call(this,t,a.html)}).on("mouseout",p),o){var u=this.getEventBus();u.subscribe("legend:mousemove",function(t){f.call(t.context,t.entry,o.html)}),u.subscribe("legend:mouseout",function(t){p.call(t.context,t.entry,t.index)})}}}function l(){return'<div><svg width="100%" height="100%"></svg></div>'}function h(){return'<div class="tooltip"><div class="tooltipContent"></div></div>'}function d(){var t=this.getD3Element(),i=function(t){return function(i){void 0!==this.cleanEventData&&(i=this.cleanEventData(i)),this.trigger(t,i,{stopPropagation:e.event.stopPropagation.bind(e.event),preventDefault:e.event.preventDefault.bind(e.event),originalEvent:e.event})}.bind(this)};t.selectAll(".datapoint.clickable").on("click",i.call(this,"entry:click")).on("contextmenu",i.call(this,"entry:contextmenu")).on("mouseenter",i.call(this,"entry:mouseenter")).on("mouseleave",i.call(this,"entry:mouseleave"))}return t.Widget.extend({baseWidth:750,baseHeight:422,defaults:{},coreDefaults:{theme:{font:{fontFamily:"Arial, sans-serif",fontSize:"12px"},colors:["#89ba17","#00a9d4","#7b0663","#00625f","#fabb00","#f08a00","#e32119","#b8d674","#99ddee","#ca9bc1","#99c0bf","#fde499","#f9d099","#f4a6a3"],container:{fill:"#fff",fillOpacity:1,stroke:"#fff",strokeWidth:0},title:{fontWeight:"normal",fontFamily:"Arial",fontSize:21,fill:"#58585b"},subTitle:{fontWeight:"normal",fontSize:14,fontFamily:"Arial",fill:"#58585b"},plotOptions:{},legend:{text:{fill:"#58585b",fontSize:"12px"}},tooltip:{position:"absolute",display:"none","z-index":1,"max-width":"50%","overflow-x":"hidden",opacity:0,margin:0,padding:"6px",color:"#666",border:"1px solid #999","border-radius":"3px","box-shadow":"0px 1px 3px rgba(0, 0, 0, 0.2)",background:"#ffffff","text-align":"center","pointer-events":"none","word-wrap":"break-word"},grid:{text:{fill:"#58585b"},axis:{fill:"#b0b2b3"},stroke:{fill:"#b0b2b3",dashArray:"1,3"},gridLines:{horizontal:!0,vertical:!1}}},chart:{margin:{top:20,right:20,bottom:20,left:20},decimals:0,decimalSeparator:".",scale:!1,zeroBaseline:!0},animation:{transitionDuration:750,transitionDelay:0,easing:"cubic-in-out"},plotOptions:{},legend:!1,tooltip:!1,title:!1,subTitle:!1,grid:!0},View:t.View.extend({getTemplate:function(){return l()},getTooltip:function(){return this.getElement().find(".tooltip")}}),init:function(){this.id=this.generateUUID(),this._eventBus=new t.EventBus,this._eventBus.subscribe("legend:click",a.bind(this));var i=JSON.parse(JSON.stringify(this.coreDefaults)),n=JSON.parse(JSON.stringify(this.defaults));n=this.objectMerger(i,n),this.options=this.objectMerger(n,this.options);var r=this.options.theme.colors,o=Array.isArray(r);this.colorScale=o?e.scale.ordinal().range(r):r;var s=this.options.data;o&&Array.isArray(s)&&this.colorScale.domain(s.map(function(t){return t.label})),this.chartSize={width:this.baseWidth,height:this.baseHeight,margins:{left:20,top:20}},this.scaleHelper={},this.toggledEntry={},this.firstRun=!0,this.createPrivateVariables()},makeGradientAverage:function(t,e,i){function n(t,e){return t+Math.round((e-t)*(i/100))}function r(t){t=Math.min(t,255),t=Math.max(t,0);var e=t.toString(16);return e.length<2&&(e="0"+e),e}var a={},o=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(t),s=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(e);return a.r=n(parseInt(o[2]),parseInt(s[2])),a.g=n(parseInt(o[3]),parseInt(o[3])),a.b=n(parseInt(o[4]),parseInt(o[4])),a.cssColor="#"+r(a.r)+r(a.g)+r(a.b),"rgb("+a.r+","+a.g+","+a.b+")"},update:function(t){Array.isArray(t)&&this.patchDataEntryVisibility(t),this.onUpdate(t),s.call(this),d.call(this),this.firstRun=!1},onUpdate:function(){},redraw:function(){throw new Error("redraw() method must be implemented")},onViewReady:function(){this.resizeEvent=t.Window.addEventHandler("resize",function(){this.resize()}.bind(this));var e=this.options;if(void 0!==e.tooltip||void 0!==e.legend.tooltip){var i=this.getElement(),n=t.Element.parse(h());n.setStyle(e.theme.tooltip),i.setStyle({position:"relative"}),i.append(n)}this._width=e.width,this._height=e.height,this.onChartReady(e)},onChartReady:function(){},onDOMAttach:function(){this._attachedToDOM=!0,this.svg=this.getD3Element(),void 0===this.defs&&(this.defs=this.svg.append("defs"));var t=this.options,e=t.theme.font;this.svg.style("font",e.fontSize+" "+e.fontFamily),this.drawBackground(),t.title!==!1&&(this.title=new i(t,this)),t.grid&&void 0===this.grid&&(this.grid=new n(t,this)),t.legend!==!1&&void 0===this.legend&&(this.legend=new r(t,this)),this.resize(),requestAnimationFrame(function(){this.trigger("domattach")}.bind(this))},onDestroy:function(){t.Window.removeEventHandler(this.resizeEvent)},getD3Element:function(){return this._svg||(this._svg=this.getElement().find("svg")._getHTMLElement()),e.select(this._svg)},getSize:function(){var t=this.getElement();return{width:t.getProperty("offsetWidth"),height:t.getProperty("offsetHeight")}},resize:function(t,e){void 0!==t&&(this._width=t),void 0!==e&&(this._height=e),this.getElement().setStyle({width:this._width||"100%",height:this._height||"100%"});var i=this.getSize();if(0!==i.width&&0!==i.height){var n=this._previousSize;void 0!==n&&n.width===i.width&&n.height===i.height||!this._attachedToDOM||(this.redraw(),this._previousSize=i)}},generateUUID:function(){var t=Date.now(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?i:7&i|8).toString(16)});return e},createSVGElement:function(){return l()},drawBackground:function(){var t=this.options.theme.container,e=t.fill;if(e){if(void 0!==this.backgroundWrapper)return;this.backgroundWrapper=this.svg.append("rect").attr("id","backgroundWrapper-"+this.id),this.backgroundWrapper.attr("width","100%").attr("height","100%");var i=e.linearGradient;if(i){var n=this.defs.append("linearGradient").attr("id","dv-backgroundgradient"+this.id).attr("x1",i.x1).attr("y1",i.y1).attr("x2",i.x2).attr("y2",i.y2);n.append("stop").attr("offset","0").attr("stop-opacity","1").attr("stop-color",e.stops[0]),n.append("stop").attr("offset","1").attr("stop-opacity","1").attr("stop-color",e.stops[1]),this.backgroundWrapper.attr("fill","url(#dv-backgroundgradient"+this.id+")"),this.backgroundType="gradient"}else{var r=t.fillOpacity;this.backgroundWrapper.attr("fill",e).attr("fill-opacity",r),this.backgroundType="flat","#ffffff"!==e&&"#fff"!==e||(this.backgroundType="white"),0===parseFloat(r)&&(this.backgroundType="transparent")}this.backgroundWrapper.attr("stroke",t.stroke).attr("stroke-width",t.strokeWidth)}},roundToDecimals:function(t,e,i){var n,r=1,a=this.options.chart;if(e)r=Math.pow(10,e),n=e;else{var o=a.decimals;r=Math.pow(10,o),n=o}return t=Math.round(t*r),t/=r,i===!0&&(t=t.toFixed(n)),t=t.toString().replace(".",a.decimalSeparator)},objectMerger:function(t,e){if(t&&e){var i,n={};Array.isArray(t)&&(n=[]);for(i in e)t.hasOwnProperty(i)&&e.hasOwnProperty(i)?"object"==typeof t[i]&&"object"==typeof e[i]?n[i]=this.objectMerger(t[i],e[i]):n[i]=e[i]:e.hasOwnProperty(i)&&(n[i]=e[i]);for(i in t)i in e||!t.hasOwnProperty(i)||(n[i]=t[i]);return n}return null},addIDsToData:function(t){var e={},i=this.options.plotOptions.scaleType;return i&&"ordinal"!==i.x?t:(t.forEach(function(t,i){if(e[t.label]?e[t.label]+="*":e[t.label]=" "," "!==e[t.label]&&(t.label=t.label+e[t.label]),t.data){var n={};t.data.forEach(function(t,e){n[t.label]?n[t.label]+="*":n[t.label]=" "," "!==n[t.label]&&(t.label=t.label+n[t.label])})}}),t)},changeSizeForDataLabels:function(t,e){},changeSizeForGrid:function(t,e){var i=this.grid;if(!i)return t;var n,r=this.options,a="horizontal"===r.plotOptions.orientation,o=a?"x":"y",s=i.getOptions().tickSize[o],l=r.grid,h=l.tickSize;if(h&&h[o])n=s;else{var d=a?this.getLongestLabelFromData(e):this.getLongestValueFromData(e),g="x"===o?i.getEntriesAxisFormat():i.getValuesAxisFormat(),c=r.chart.scale;if(c&&c.y){var f=c.y.max,p=c.y.min;d=f.toString().length>p.toString().length?f:p}d=this.localizeValueString(d,g),n=this.measureTextFieldSize(d),n.width+=10,n.height+=6,s.width=n.width,s.height=n.height}var u=i.yAxisSize;u!==!1&&(n={height:n.height,width:u});var v=Math.ceil(n.width),b=Math.ceil(n.height);if(t.margins.left+=v,t.width-=v,t.height-=b+5,l.axisLabels){var m=i.getEntriesAxisLabelSize(),y=i.getValuesAxisLabelSize(),x=void 0!==m?Math.round(m.height):0,w=void 0!==y?Math.round(y.height):0;a?(t.height-=w,x>0&&(t.width-=x+10,t.margins.left+=x+10)):(t.height-=x,w>0&&(t.width-=w+15,t.margins.left+=w+15))}return t},changeSizeForTitle:function(t){if(this.options.title){var e=this.title.getTitleSize();t.margins.top+=e.height+10,t.height-=e.height+10}return t},changeSizeForLegend:function(t,e){if(this.options.legend!==!1){var i=this.getLongestLabelFromData(e),n=this.measureTextFieldSize(i),r=this.legend;if("bottom"===r.align){var a=r.createLegendItems(e);r.positionLegendItemsAtBottom(a,t),n=r.legendWrapper.node().getBBox(),t.height-=Math.ceil(n.height)+10}else"right"===r.align&&(t.width-=Math.ceil(n.width)+2*r.circleRadius+r.circleDistance+10)}return t},measureTextFieldSize:function(t,e,i){var n=this.options.theme.font,r=this.svg.append("g"),a=e?e:n.fontSize,o=i?i:n.fontFamily;return r.attr("transform","translate(-1000,-1000)"),r.append("text").attr("font-size",a).attr("font-family",o).text(t),setTimeout(function(){r.remove()},10),r.node().getBBox()},localizeValueString:function(t,e){function i(t){return Math.round(t).toString().replace(/./g,function(t,e,i){return!e||"."===t||(i.length-e)%3?t:","+t})}return void 0!==e?e(t):i(t)},getLongestValueFromData:function(t){return this.getLongestStringFromData("value",t)||"0"},getLongestLabelFromData:function(t){return this.getLongestStringFromData("label",t)},getLongestStringFromData:function(t,e){var i="";return e.forEach(function(e,n){var r="";Array.isArray(e.data)?e.data.forEach(function(e){var i=e[t],n="label"===t?i:Math.round(i<1?1e3*i:i),a=n.toString();a.length>r.length&&(r=a)}):(e[t]||0===e[t])&&(r=e[t].toString()),r.length>i.length&&(i=r)}),i},getLongestTitleFromData:function(t){return o("title",t)},wrapTextField:function(t,e,i,n,r,a){for(var o,s=e.split(/\s+/).reverse(),l=[],h=1,d=s.pop(),g=this.svg.append("text").attr("font-family",t.attr("font-family")).attr("font-size",t.attr("font-size")).attr("x",-1e3).attr("y",-1e3),c=t.append("tspan").attr("x",i);d&&(l.push(d),o=l.join(" "),g.text(o),c.text(o),h!==a);)g.node().getBBox().width>n&&(l.pop(),c.text(l.join(" ")),l=[d],c=t.append("tspan").attr("x",i).attr("dy",r+"em"),h++),d=s.pop();g.remove()},wrapTextEllipsis:function(t,i,n,r){t.each(function(t,a){var o=e.select(this),s=o.selectAll("text");if(!s.empty()){var l,h=o.selectAll(".wrappedText"),d=o.selectAll(".wrappingFobj"),g=s.node().getBBox();if(d.empty()&&(d=o.append("foreignObject").attr("class","wrappingFobj"),h=d.append("xhtml:p").attr("class","wrappedText")),void 0!==i&&d.attr("width",Math.max(0,i.width||Math.ceil(g.width))).attr("height",Math.max(0,i.height||Math.ceil(g.height))),void 0!==n){var c=n[a]||{x:g.x,y:g.y};d.attr("x",-c.x).attr("y",c.y)}l=s.text(),s.style("opacity",0),r&&r.title===!1||(h.attr("title",l),h.style("z-index",1)),h.text(l)}})},createPrivateVariables:function(){},toggleEntryVisibility:function(t){t.visible=void 0!==t.visible&&!t.visible;var e=this.toggledEntry[t.label];void 0!==e&&e===t.visible||(this.toggledEntry[t.label]=t.visible)},patchDataEntryVisibility:function(t){var e=this.firstRun,i=this.toggledEntry;if(!e&&0===Object.keys(i).length)return t;var n=function(t){return Array.isArray(t)?t.map(n):(e&&t.visible===!1?i[t.label]=t.visible:void 0!==i[t.label]&&(t.visible=i[t.label]),void(void 0!==t.data&&t.data.forEach(n)))};return t.map(n)},getEventBus:function(){return this._eventBus},getTooltipContent:function(t){void 0!==this.cleanEventData&&(t=this.cleanEventData(t));var e=this.options.tooltip,i=this.getDataLabelFormat(),n=function(t){return t.label+" : "+("number"==typeof t.value?i(t.value):t.value.toString())},r="function"==typeof e.format?e.format:n;return r.call(this,t)},getLegendTooltipContent:function(t){var e=this.options.legend.tooltip,i=e&&"function"==typeof e.format?e.format:function(t){return t.label};return i.call(this,t)},getDataLabelFormat:function(){var t=this.options,i=t.grid.tickFormat,n=i&&i.y?i.y:void 0;return void 0!==n?"string"==typeof n?e.format(n):n:e.format(",."+(t.chart.decimals||0)+"f")}})}),define("chartlib/charts/Chart",["chartlib/charts/_base/Chart"],function(t){return t});