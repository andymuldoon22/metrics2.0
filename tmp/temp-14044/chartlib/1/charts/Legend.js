/* Copyright (c) Ericsson 2019 */

define("chartlib/charts/_base/Legend",["chartlib/base/d3"],function(t){"use strict";return function(e,i){var n,r,s,a={legend:{align:"bottom",centered:!1,icons:!0,circleRadius:5}};this.init=function(){if(n=i,e.legend===!0){var t=a.legend;a=n.objectMerger(a,e),a.legend=t}else a=n.objectMerger(a,e);this.align=a.legend.align,this.circleRadius=a.legend.circleRadius,this.circleDistance=10,this.xPositions=!1,r=n.svg,s=n.defs,this.legendWrapper=r.append("g").attr("id","legendWrapper-"+n.id)},this.update=function(t,e){this._legendData=t;var i=this.createLegendItems(t);"bottom"===this.align?this.xPositions!==!1?this.positionLegendItemsAfterXPositions(i,e):this.positionLegendItemsAtBottom(i,e):"right"===this.align&&this.positionLegendItemsAtRight(i,e)},this.createLegendItems=function(t){var e,i=a.legend,r=i.icons===!0?2*i.circleRadius+this.circleDistance:0,s=this.legendWrapper.selectAll("g.legendItem").data(t),l=void 0!==i.events,o=function(t,e){return{context:this,entry:t,index:e}},c=t.filter(function(t){return t.visible!==!1}).length;s.enter().append("g").attr("class","legendItem").style("pointer-events",function(){return l?"all":"inherit"}),s.exit().remove(),s.style("opacity",function(t){return t.visible===!1?.4:1}).style("cursor",function(t){return!l||t.visible!==!1&&t.visible!==!1&&1===c?"inherit":"pointer"}),(l||void 0!==i.tooltip)&&s.on("click",function(t,e){var i=o.apply(this,arguments),r=a.legend.events;i.type=r?r.click:void 0,n.getEventBus().publish("legend:click",i)}).on("mousemove",function(){n.getEventBus().publish("legend:mousemove",o.apply(this,arguments))}).on("mouseout",function(){n.getEventBus().publish("legend:mouseout",o.apply(this,arguments))}),e=s.selectAll("text.legendLabel").data(function(t,e){return[t]});var h=a.theme.legend.text;if(e.enter().append("text").attr("class","enter legendLabel").attr("fill",h.fill).attr("dy","0.75em").attr("font-size",h.fontSize).attr("transform","translate("+r+",0)"),e.text(function(t){return t.label}),i.icons===!0){var d=s.selectAll("circle.legendIcon").data(function(t,e){return[t]});d.enter().append("circle").attr("r",i.circleRadius).attr("transform","translate("+i.circleRadius+","+(i.circleRadius-1)+")").attr("class","enter legendIcon"),d.attr("fill",function(t){return n.colorScale(t.label,t)})}return s},this.positionLegendItemsAtBottom=function(e,n){var r=0,s=0;e.each(function(e,i){var a=t.select(this),l=this.getBBox();r+l.width>n.width&&(r=0,s+=l.height+5),a.attr("transform","translate("+r+","+s+")"),r+=l.width+20});var l=this.legendWrapper.node().getBBox(),o=i.getSize(),c=n.margins,h=a.legend.centered===!0?(n.width-l.width)/2+c.left:c.left,d=o.height-a.chart.margin.bottom-l.height;this.legendWrapper.attr("transform","translate("+h+", "+d+")")},this.positionLegendItemsAtRight=function(e,i){var n=0;e.each(function(e,i){var r=t.select(this);r.attr("transform","translate(0,"+n+")"),n+=this.getBBox().height+10});var r=this.legendWrapper.node().getBBox(),s=i.margins,l=a.legend.centered===!0?(i.height-r.height)/2+s.top:s.top;this.legendWrapper.attr("transform","translate("+(s.left+i.width+10)+", "+l+")")},this.positionLegendItemsAfterXPositions=function(e,i){var r=i.margins;this.legendWrapper.attr("transform","translate("+r.left+", "+(r.top+i.height+10)+")");var s=this.xPositions;e.call(function(t){n.wrapTextEllipsis(t,{})}),e.each(function(e,i){var n=t.select(this);n.attr("transform","translate("+s[i].x+",0)"),n.selectAll(".wrappingFobj").attr("width",Math.max(0,Math.ceil(s[i].w)))}),this.legendWrapper.selectAll("g.legendItem .wrappedText").each(function(e,i){var n=t.select(this);n.style({"line-height":"1.2rem","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","text-align":"center",margin:"0","font-weight":"normal","word-wrap":"break-word",width:Math.ceil(s[i].w)+"px"})})},this.getLegendData=function(){return this._legendData},this.init()}}),define("chartlib/charts/Legend",["chartlib/charts/_base/Legend"],function(t){return t});